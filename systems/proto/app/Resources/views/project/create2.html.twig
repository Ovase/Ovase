{% extends 'base.html.twig' %}

{% block title %}
  Nytt prosjekt
{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link href="{{ asset('static/css/buttons.css') }}" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>
  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick-theme.css"/>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <!-- Delete image and image carousel functionality -->
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js"></script>
  <script type="text/javascript">
    function addImageFormDeleteLink($imageFormDiv) {
        var $removeFormA = $('<a href="#">Delete this image</a>');
        $imageFormDiv.append($removeFormA);
        $removeFormA.on('click', function(e) {
            e.preventDefault();
            $imageFormDiv.remove();
        });
    }

    var $addImageLink = $('<a href="#" class="add_image_link">Add image</a>');

    $(document).ready(function() {
        // Get collection, add "buttons" with click events
        var $collectionHolder = $('#editProjectStep1_images');
        $collectionHolder.find('input[type="hidden"]').each(function() {
            var value = this.value;
            var $imageDiv = $('<div class="img-preview"></div>').html('<img src="' + value + '">');
            $(this).after($imageDiv);
        });
        $collectionHolder.children('div').each(function() {
            addImageFormDeleteLink($(this));
        });
        // Init carousel
        $('.img-carousel').slick({});
        // Add click event
        $('.img-carousel-image').on('click', function(event) {
          window.location.href = event.currentTarget['src'];
        });
    });
    </script>
  {# TODO: DatePicker and more #}
{% endblock %}

{% block body %}

    <section class="narrow centered">
      <p class="f4 b">Merk at obligatoriske felter er merket med stjernetegnet (*)</p>

      {# Form theme adds help message block #}
      {% form_theme form 'form/fields.html.twig' %}

      <div class="mt3">
        {% include '@CraueFormFlow/FormFlow/stepList.html.twig' %}
      </div>

      <!-- Show project summary on last page -->
      {% if flow.getCurrentStepNumber() == flow.getStepCount() %}
        <h2>Forhåndsvisning</h2>
        <p class="mb3">Se over prosjektdetaljene under. Gå til bunnen av siden for å opprette prosjektet</p>
    </section>
    <section class="proj-preview">
      {% set project = flow.formData %}
      {% include 'project/project.base.html.twig' %}
    </section>
    <section class="narrow centered">
      {% endif %}

      {{ form_start(form, { 'attr' : { 'class': 'full-wide ovase-form ovase-form-ext' }} ) }}
      {{ form_widget(form) }}

     {% if form.vars.end_message is defined %} 
      <div class="form-info-box">
        <p>{{ form.vars.end_message }}</p>
      </div>
      {% endif %}

      {% include '@CraueFormFlow/FormFlow/buttons.html.twig' with {
        craue_formflow_button_class_last: 'button-last',
        craue_formflow_button_class_back: 'button-back',
        craue_formflow_button_class_next: 'button-next',
        craue_formflow_button_class_finish: 'button-finish',
        craue_formflow_button_label_back: 'Forrige side',
        craue_formflow_button_label_next: 'Neste side',
        craue_formflow_button_label_finish: 'Opprett prosjekt',
        craue_formflow_button_render_reset: false
      } %}
      {{ form_end(form) }}

{% endblock %}


