{% extends 'base.html.twig' %}

{% block title %}
  Nytt prosjekt
{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link href="{{ asset('static/css/buttons.css') }}" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>
  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick-theme.css"/>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
{% endblock %}

{% block body %}

    <section class="narrow centered">
      <p class="f4 b">Merk at obligatoriske felter er merket med stjernetegnet (*)</p>

      {# Form theme adds help message block #}
      {% form_theme form 'form/fields.html.twig' %}

      <div class="mt3">
        {% include '@CraueFormFlow/FormFlow/stepList.html.twig' %}
      </div>

      <!-- Show project summary on last page -->
      {% if flow.getCurrentStepNumber() == flow.getStepCount() %}
        <h2>Forhåndsvisning</h2>
        <p class="mb3">Se over prosjektdetaljene under. Gå til bunnen av siden for å opprette prosjektet</p>
    </section>
    <section class="proj-preview">
      {% set project = flow.formData %}
      {% include 'project/project.base.html.twig' %}
    </section>
    <section class="narrow centered">
      {% endif %}

      {{ form_start(form, { 'attr' : { 'class': 'full-wide ovase-form ovase-form-ext' }} ) }}
      {{ form_widget(form) }}

      {% block form_info_box %} 
        {% if form.vars.create_end_message is defined %} 
        <div class="form-info-box">
          <p>{{ form.vars.create_end_message }}</p>
        </div>
        {% endif %}
      {% endblock %}

      {% include '@CraueFormFlow/FormFlow/buttons.html.twig' with {
        craue_formflow_button_class_last: 'button-last',
        craue_formflow_button_class_back: 'button-back',
        craue_formflow_button_class_next: 'button-next',
        craue_formflow_button_class_finish: 'button-finish',
        craue_formflow_button_label_back: 'Forrige side',
        craue_formflow_button_label_next: 'Neste side',
        craue_formflow_button_label_finish: 'Opprett prosjekt',
        craue_formflow_button_render_reset: false
      } %}
      {{ form_end(form) }}

{% endblock %}


{% block javascripts %}
  {{ parent() }}
  <!-- Translation of user-typed addresses to coordinates -->
  <script src="{{ asset('static/js/addressTranslator.js') }}"></script>
  <!-- Datepicker + settings -->
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="{{ asset('static/js/datepicker-no.js') }}"></script>
  <!-- Image preview, "delete image" buttons -->
  <script src="{{ asset('static/js/imageUpload.js') }}"></script>
  <!-- Delete image and image carousel functionality -->
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js"></script>
  <!-- Initialization -->
  <script type="text/javascript">
    $(document).ready(function() {
        // Get collection, add delete "buttons"
        var $collectionHolder = $('#editProjectStep1_images');
        initImageUploadFunctionality($collectionHolder);
        // Init carousel
        $('.img-carousel').slick({});
        // Add click event
        $('.img-carousel-image').on('click', function(event) {
          window.location.href = event.currentTarget['src'];
        });
        // Init address translator
        prepareAddressTranslator('editProjectStep1', "#editProjectStep1_location");
        // Init date picker
        $("#editProjectStep1_enddate").datepicker($.datepicker.regional[ "no" ]);
    });
    </script>
  {# TODO: select2 thingy #}
{% endblock %}